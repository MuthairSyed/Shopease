{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block content %}
<div class="container mt-4 mb-5">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'shop:home_page' %}">Home</a></li>
      <li class="breadcrumb-item"><a href="{% url 'orders:user_orders' %}">My Orders</a></li>
      <li class="breadcrumb-item active" aria-current="page">Invoice</li>
    </ol>
  </nav>
  
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Invoice #SE-{{ order.id }}</h5>
          <a href="{% url 'orders:download_invoice' order.id %}" class="btn btn-primary">
            <i class="fas fa-download me-1"></i> Download PDF
          </a>
        </div>
        <div class="card-body p-0">
          <!-- Invoice Header -->
          <div class="invoice-header bg-gradient-primary text-white p-4">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h2 class="mb-1">ShopEase</h2>
                <p class="mb-0 opacity-75">Simple. Fast. Delightful.</p>
              </div>
              <div class="text-end">
                <h3 class="mb-1">INVOICE</h3>
                <p class="mb-0">#SE-{{ order.id }}</p>
              </div>
            </div>
            
            <div class="row mt-4">
              <div class="col-md-4">
                <h6 class="mb-3">Bill To:</h6>
                {% if order.delivery_address %}
                <p class="mb-1"><strong>{{ order.delivery_address.full_name }}</strong></p>
                <p class="mb-1">{{ order.delivery_address.street_address }}</p>
                <p class="mb-1">{{ order.delivery_address.city }}, {{ order.delivery_address.state }} {{ order.delivery_address.postal_code }}</p>
                <p class="mb-1">{{ order.delivery_address.country }}</p>
                <p class="mb-0">{{ order.delivery_address.phone_number }}</p>
                {% else %}
                <p class="mb-1"><strong>{{ user.full_name|default:user.email }}</strong></p>
                <p class="mb-1">{{ user.email }}</p>
                <p class="mb-1">+91 89712 78930</p>
                <p class="mb-0">123 Shopping Street, Retail City, 560032</p>
                {% endif %}
              </div>
              
              <div class="col-md-4">
                <h6 class="mb-3">Ship To:</h6>
                {% if order.delivery_address %}
                <p class="mb-1"><strong>{{ order.delivery_address.full_name }}</strong></p>
                <p class="mb-1">{{ order.delivery_address.street_address }}</p>
                <p class="mb-1">{{ order.delivery_address.city }}, {{ order.delivery_address.state }} {{ order.delivery_address.postal_code }}</p>
                <p class="mb-0">{{ order.delivery_address.country }}</p>
                {% else %}
                <p class="mb-1"><strong>{{ user.full_name|default:user.email }}</strong></p>
                <p class="mb-1">123 Shopping Street, Retail City, 560032</p>
                {% endif %}
              </div>
              
              <div class="col-md-4">
                <h6 class="mb-3">Invoice Details:</h6>
                <table class="table table-borderless text-white">
                  <tr>
                    <td class="ps-0">Invoice #:</td>
                    <td class="text-end">SE-{{ order.id }}</td>
                  </tr>
                  <tr>
                    <td class="ps-0">Order ID:</td>
                    <td class="text-end">ORD-{{ order.id }}</td>
                  </tr>
                  <tr>
                    <td class="ps-0">Issue Date:</td>
                    <td class="text-end">{{ order.created|date:"M d, Y" }}</td>
                  </tr>
                  <tr>
                    <td class="ps-0">Status:</td>
                    <td class="text-end">
                      {% if order.status == 'pending' %}
                        <span class="badge bg-warning">Pending</span>
                      {% elif order.status == 'processing' %}
                        <span class="badge bg-info">Processing</span>
                      {% elif order.status == 'shipped' %}
                        <span class="badge bg-primary">Shipped</span>
                      {% elif order.status == 'delivered' %}
                        <span class="badge bg-success">Delivered</span>
                      {% elif order.status == 'cancelled' %}
                        <span class="badge bg-danger">Cancelled</span>
                      {% endif %}
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Invoice Body -->
          <div class="p-4">
            <h5 class="mb-4">Order Items</h5>
            
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Item Description</th>
                    <th>SKU</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-end">Unit Price</th>
                    <th class="text-end">Total</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in items %}
                  <tr>
                    <td>
                      <div class="fw-bold">{{ item.product.title }}</div>
                      <div class="text-muted small">{{ item.product.description|truncatewords:10 }}</div>
                    </td>
                    <td>SE-{{ item.product.id }}</td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end">‚Çπ{{ item.price }}</td>
                    <td class="text-end">‚Çπ{{ item.get_cost }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            
            <div class="row justify-content-end">
              <div class="col-md-5">
                <table class="table table-borderless">
                  <tr>
                    <td class="border-top-0">Subtotal:</td>
                    <td class="text-end border-top-0">‚Çπ{{ order.get_total_price }}</td>
                  </tr>
                  <tr>
                    <td>Shipping:</td>
                    <td class="text-end">‚Çπ0.00</td>
                  </tr>
                  <tr>
                    <td>GST (18%):</td>
                    <td class="text-end">‚Çπ{{ gst|floatformat:2 }}</td>
                  </tr>
                  <tr class="table-active">
                    <td><strong>Total:</strong></td>
                    <td class="text-end"><strong>‚Çπ{{ total|floatformat:2 }}</strong></td>
                  </tr>
                </table>
              </div>
            </div>
            
            <div class="bg-light p-3 rounded mt-4">
              <h6 class="mb-3">Payment Information</h6>
              <div class="row">
                <div class="col-md-6">
                  <p class="mb-1"><strong>Payment Method:</strong> Secure Payment Gateway</p>
                  <p class="mb-1"><strong>Payment Status:</strong> 
                    {% if order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}
                      <span class="text-success">Paid</span>
                    {% else %}
                      <span class="text-warning">Pending</span>
                    {% endif %}
                  </p>
                </div>
                <div class="col-md-6">
                  <p class="mb-1"><strong>Transaction ID:</strong> TXN-SE-{{ order.id }}{{ order.created|date:"Ymd" }}</p>
                  <p class="mb-0"><strong>Currency:</strong> INR (‚Çπ)</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Invoice Footer -->
          <div class="invoice-footer bg-light p-4">
            <div class="text-center">
              <p class="mb-1"><strong>ShopEase E-commerce Platform</strong></p>
              <p class="mb-1">support@shopease.com ‚Ä¢ +91 89712 78930</p>
              <p class="mb-0">123 Shopping Street, Retail City, 560032</p>
              <p class="mt-3 mb-0 text-muted">Thank you for your business! üôè</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.bg-gradient-primary {
  background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%) !important;
}
</style>
{% endblock %}