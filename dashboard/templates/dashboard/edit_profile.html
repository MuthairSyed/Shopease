{% extends "dashboard/base.html" %}
{% load crispy_forms_tags %}

{% block page_title %}Edit Profile{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card card-dashboard">
      <div class="card-header text-center">
        <h3>Edit Profile</h3>
      </div>
      <div class="card-body">
        <form method="POST">
          {% csrf_token %}
          <!-- Profile fields (excluding password fields) -->
          {% for field in form %}
            {% if field.name != 'old_password' and field.name != 'new_password1' and field.name != 'new_password2' %}
              {{ field|as_crispy_field }}
            {% endif %}
          {% endfor %}
          
          <!-- Password Change Section -->
          <div class="border-top pt-3 mt-4">
            <h5>Change Password</h5>
            <div class="mb-3">
              <label for="{{ form.old_password.id_for_label }}" class="form-label">Current Password</label>
              <div class="input-group">
                {{ form.old_password }}
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="id_old_password">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              {% if form.old_password.errors %}
                <div class="text-danger small">{{ form.old_password.errors }}</div>
              {% endif %}
            </div>
            
            <div class="mb-3">
              <label for="{{ form.new_password1.id_for_label }}" class="form-label">New Password</label>
              <div class="input-group">
                {{ form.new_password1 }}
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="id_new_password1">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              {% if form.new_password1.errors %}
                <div class="text-danger small">{{ form.new_password1.errors }}</div>
              {% endif %}
            </div>
            
            <div class="mb-3">
              <label for="{{ form.new_password2.id_for_label }}" class="form-label">Confirm New Password</label>
              <div class="input-group">
                {{ form.new_password2 }}
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="id_new_password2">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              {% if form.new_password2.errors %}
                <div class="text-danger small">{{ form.new_password2.errors }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="d-grid">
            <button class="btn btn-primary btn-lg" type="submit">Update Profile</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(function(button) {
        button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const passwordInput = document.getElementById(targetId);
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    });
});
</script>
{% endblock %}